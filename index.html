<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>â‚¹20 Contest â€“ Win iPhone / Cash</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Segoe UI,Roboto,Arial}
body{margin:0;background:#0f172a;color:#fff}
.container{max-width:420px;margin:auto;padding:20px}
.card{
  background:#111827;
  border-radius:14px;
  padding:20px;
  margin-bottom:15px;
  box-shadow:0 0 20px rgba(0,0,0,.7)
}
h2,h3{text-align:center;margin:10px 0}
input,button{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:none;
  margin-top:10px;
  font-size:15px
}
input{background:#1f2933;color:#fff}
button{
  background:#22c55e;
  color:#000;
  font-weight:700;
  cursor:pointer
}
button.danger{background:#ef4444;color:#fff}
.hidden{display:none}
.wallet{
  font-size:26px;
  font-weight:700;
  text-align:center;
  margin:10px 0
}
.upi{
  background:#020617;
  padding:10px;
  border-radius:8px;
  text-align:center;
  margin-top:10px
}
.small{
  font-size:13px;
  color:#9ca3af;
  text-align:center
}
.success{color:#22c55e;text-align:center}
.warning{color:#facc15;text-align:center}
</style>
</head>

<body>
<div class="container">

<!-- AUTH -->
<div id="authBox" class="card">
  <h2>Login / Signup</h2>
  <input id="emailInput" placeholder="Email">
  <input id="passwordInput" type="password" placeholder="Password">
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Login</button>
  <p class="small">â‚¹20 participation contest</p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="card">
    <h3>Wallet Balance</h3>
    <div class="wallet">â‚¹ <span id="wallet">0</span></div>
  </div>

  <div class="card">
    <h3>Deposit â‚¹20</h3>
    <div class="upi">
      Pay â‚¹20 to<br>
      <b>riya09876@ybl</b>
    </div>
    <input id="utrInput" placeholder="Enter UTR / Transaction ID">
    <button onclick="submitDeposit()">Submit Deposit</button>
    <p class="small">Deposit will be approved manually</p>
  </div>

  <div class="card">
    <h3>Participate</h3>
    <button onclick="participate()">Join Contest â€“ â‚¹20</button>
    <p id="joinMsg" class="small"></p>
  </div>

  <div class="card">
    <h3>Winner</h3>
    <p id="winnerText" class="success">No winner announced yet</p>
  </div>

  <button class="danger" onclick="logout()">Logout</button>

</div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  updateDoc,
  addDoc,
  collection,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ðŸ”¥ YOUR NEW FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyDCRzNqoUD1TARXKrgf2g94vOYPd4BjLlY",
  authDomain: "smash-stock-28150.firebaseapp.com",
  projectId: "smash-stock-28150",
  storageBucket: "smash-stock-28150.firebasestorage.app",
  messagingSenderId: "1004308967058",
  appId: "1:1004308967058:web:5125c899758d8390ed004b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* AUTH */
window.signup = async () => {
  const emailVal = document.getElementById("emailInput").value;
  const passVal  = document.getElementById("passwordInput").value;
  if(!emailVal || !passVal) return alert("Fill all fields");

  const res = await createUserWithEmailAndPassword(auth, emailVal, passVal);

  await setDoc(doc(db,"users",res.user.uid),{
    email: emailVal,
    wallet: 0,
    created: serverTimestamp()
  });
};

window.login = async () => {
  const emailVal = document.getElementById("emailInput").value;
  const passVal  = document.getElementById("passwordInput").value;
  await signInWithEmailAndPassword(auth, emailVal, passVal);
};

window.logout = () => signOut(auth);

/* AUTH STATE */
onAuthStateChanged(auth, async user=>{
  if(!user){
    authBox.classList.remove("hidden");
    dashboard.classList.add("hidden");
    return;
  }
  authBox.classList.add("hidden");
  dashboard.classList.remove("hidden");
  loadWallet();
  loadWinner();
});

/* WALLET */
async function loadWallet(){
  const uid = auth.currentUser.uid;
  const snap = await getDoc(doc(db,"users",uid));
  wallet.innerText = snap.data().wallet;
}

/* DEPOSIT */
window.submitDeposit = async () => {
  const utrVal = document.getElementById("utrInput").value;
  if(!utrVal) return alert("Enter UTR");

  await addDoc(collection(db,"deposits"),{
    uid: auth.currentUser.uid,
    amount: 20,
    utr: utrVal,
    status: "pending",
    time: serverTimestamp()
  });

  document.getElementById("utrInput").value="";
  alert("Deposit submitted. Waiting for approval.");
};

/* PARTICIPATE */
window.participate = async () => {
  const uid = auth.currentUser.uid;
  const ref = doc(db,"users",uid);
  const snap = await getDoc(ref);

  if(snap.data().wallet < 20){
    joinMsg.innerText = "Insufficient balance";
    return;
  }

  await updateDoc(ref,{
    wallet: snap.data().wallet - 20
  });

  await addDoc(collection(db,"participants"),{
    uid,
    joined: serverTimestamp()
  });

  joinMsg.innerText = "Successfully joined contest";
  loadWallet();
};

/* WINNER */
async function loadWinner(){
  const winSnap = await getDoc(doc(db,"winner","current"));
  if(winSnap.exists()){
    winnerText.innerText =
      "Winner: " + winSnap.data().email +
      " | Prize: " + winSnap.data().prize;
  }
}
</script>

</body>
</html>
