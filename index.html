<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>₹20 Contest – Win iPhone / Cash</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Segoe UI,Roboto,Arial}
body{margin:0;background:#0f172a;color:#fff}
.container{max-width:420px;margin:auto;padding:15px}

/* Instagram Slider */
.insta-slider{height:100px;overflow:hidden;border-radius:12px;margin-bottom:15px}
.slides{display:flex;width:300%;animation:slide 12s infinite}
.slides img{width:100%;height:100px;object-fit:cover}
@keyframes slide{
  0%{transform:translateX(0)}
  33%{transform:translateX(-100%)}
  66%{transform:translateX(-200%)}
}

/* Cards */
.card{background:#111827;border-radius:14px;padding:20px;margin-bottom:15px}
h2,h3{text-align:center;margin:8px 0}
input,button{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:none;
  margin-top:10px;
  font-size:15px
}
input{background:#1f2933;color:#fff}
button{background:#22c55e;color:#000;font-weight:700;cursor:pointer}
button.danger{background:#ef4444;color:#fff}
.hidden{display:none}
.wallet{font-size:26px;font-weight:700;text-align:center}
.small{text-align:center;font-size:13px;color:#9ca3af}

/* Winner */
.winner-box{text-align:center}
.winner-box img{
  width:70px;height:70px;border-radius:50%;
  object-fit:cover;border:2px solid #22c55e;margin-bottom:5px
}

/* Withdrawal History */
.history{
  background:#020617;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
  font-size:14px
}
.pending{color:#facc15}
.approved{color:#22c55e}
.rejected{color:#ef4444}
</style>
</head>

<body>
<div class="container">

<!-- Instagram Slider -->
<div class="insta-slider">
  <div class="slides">
    <img src="https://picsum.photos/400/200?1">
    <img src="https://picsum.photos/400/200?2">
    <img src="https://picsum.photos/400/200?3">
  </div>
</div>

<!-- AUTH -->
<div id="authBox" class="card">
  <h2>Login / Signup</h2>
  <input id="emailInput" placeholder="Email">
  <input id="passwordInput" type="password" placeholder="Password">
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

<div class="card">
  <h3>Wallet Balance</h3>
  <div class="wallet">₹ <span id="wallet">0</span></div>
</div>

<div class="card">
  <h3>Winner</h3>
  <div class="winner-box">
    <img id="winnerPhoto">
    <h4 id="winnerName">No winner yet</h4>
    <p id="winnerPrize"></p>
  </div>
</div>

<div class="card">
  <h3>Participate</h3>
  <button onclick="participate()">Join Contest – ₹20</button>
  <p id="joinMsg" class="small"></p>
</div>

<div class="card">
  <h3>Deposit ₹20</h3>
  <button onclick="openUPI()">Pay ₹20 via UPI</button>
  <input id="utrInput" placeholder="Enter UTR / Transaction ID">
  <button onclick="submitDeposit()">Submit Deposit</button>
</div>

<!-- Withdrawal -->
<div class="card">
  <h3>Withdrawal</h3>
  <input id="withdrawUpi" placeholder="Enter your UPI ID">
  <input id="withdrawAmount" type="number" placeholder="Enter amount">
  <button onclick="submitWithdrawal()">Request Withdrawal</button>
  <div id="withdrawHistory"></div>
</div>

<button class="danger" onclick="logout()">Logout</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,createUserWithEmailAndPassword,
  signInWithEmailAndPassword,onAuthStateChanged,signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,doc,setDoc,getDoc,updateDoc,
  addDoc,collection,serverTimestamp,
  query,where,orderBy,getDocs
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* Firebase */
const firebaseConfig={
  apiKey:"AIzaSyDCRzNqoUD1TARXKrgf2g94vOYPd4BjLlY",
  authDomain:"smash-stock-28150.firebaseapp.com",
  projectId:"smash-stock-28150",
  storageBucket:"smash-stock-28150.firebasestorage.app",
  messagingSenderId:"1004308967058",
  appId:"1:1004308967058:web:5125c899758d8390ed004b"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* AUTH */
window.signup=async()=>{
  const r=await createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
  await setDoc(doc(db,"users",r.user.uid),{wallet:0});
};
window.login=()=>signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
window.logout=()=>signOut(auth);

/* AUTH STATE */
onAuthStateChanged(auth,async u=>{
  if(!u){
    authBox.classList.remove("hidden");
    dashboard.classList.add("hidden");
    return;
  }
  authBox.classList.add("hidden");
  dashboard.classList.remove("hidden");

  const s=await getDoc(doc(db,"users",u.uid));
  wallet.innerText=s.data().wallet;

  loadWithdrawHistory();

  const w=await getDoc(doc(db,"winner","current"));
  if(w.exists()){
    winnerName.innerText=w.data().name;
    winnerPrize.innerText=w.data().prize;
    winnerPhoto.src=w.data().photo;
  }
});

/* UPI */
window.openUPI=()=>{
  location.href="upi://pay?pa=riya09876@ybl&pn=Contest&am=20&cu=INR";
};

/* Deposit */
window.submitDeposit=async()=>{
  if(!utrInput.value) return alert("Enter UTR");
  await addDoc(collection(db,"deposits"),{
    uid:auth.currentUser.uid,
    amount:20,
    utr:utrInput.value,
    status:"pending",
    time:serverTimestamp()
  });
  utrInput.value="";
  alert("Deposit submitted");
};

/* Participate */
window.participate=async()=>{
  const ref=doc(db,"users",auth.currentUser.uid);
  const s=await getDoc(ref);
  if(s.data().wallet<20){
    joinMsg.innerText="Insufficient balance";
    return;
  }
  await updateDoc(ref,{wallet:s.data().wallet-20});
  wallet.innerText=s.data().wallet-20;
  joinMsg.innerText="Joined successfully";
};

/* Withdrawal */
window.submitWithdrawal=async()=>{
  const upi=withdrawUpi.value;
  const amount=Number(withdrawAmount.value);

  const ref=doc(db,"users",auth.currentUser.uid);
  const s=await getDoc(ref);

  if(amount>s.data().wallet){
    alert("Insufficient balance");
    return;
  }

  await updateDoc(ref,{wallet:s.data().wallet-amount});
  wallet.innerText=s.data().wallet-amount;

  await addDoc(collection(db,"withdrawals"),{
    uid:auth.currentUser.uid,
    upi,amount,
    status:"pending",
    time:serverTimestamp()
  });

  withdrawUpi.value="";
  withdrawAmount.value="";
  loadWithdrawHistory();
};

/* Withdrawal History */
async function loadWithdrawHistory(){
  withdrawHistory.innerHTML="";
  const q=query(
    collection(db,"withdrawals"),
    where("uid","==",auth.currentUser.uid),
    orderBy("time","desc")
  );
  const snap=await getDocs(q);
  snap.forEach(d=>{
    const x=d.data();
    withdrawHistory.innerHTML+=`
      <div class="history ${x.status}">
        ₹${x.amount}<br>
        UPI: ${x.upi}<br>
        Status: ${x.status}
      </div>
    `;
  });
}
</script>

</body>
</html>
